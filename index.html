<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Jump Cube</title>

<style>
:root {
  --bg1: #0f2027;
  --bg2: #203a43;
  --bg3: #2c5364;
  --accent: #4ef3c2;
  --danger: #ff5f6d;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  overflow: hidden;
  font-family: system-ui, sans-serif;
  background: linear-gradient(180deg, var(--bg1), var(--bg2), var(--bg3));
  color: #fff;
  touch-action: manipulation;
}

canvas {
  display: block;
}

.ui {
  position: absolute;
  top: 16px;
  left: 16px;
  right: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  pointer-events: none;
}

.panel {
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(8px);
  padding: 12px 18px;
  border-radius: 14px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  pointer-events: auto;
}

.panel div {
  font-size: 16px;
  line-height: 1.4;
}

button {
  border: none;
  border-radius: 14px;
  font-size: 20px;
  padding: 14px 26px;
  background: linear-gradient(135deg, var(--accent), #3acfd5);
  color: #002;
  font-weight: 700;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

button:active {
  transform: translateY(2px);
}

#jumpBtn {
  position: absolute;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 26px;
  padding: 24px 70px;
}

.game-over {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.55);
  font-size: 42px;
  font-weight: 800;
  display: none;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div class="ui">
  <div class="panel">
    <div>Очки: <span id="score">0</span></div>
    <div>Рекорд: <span id="best">0</span></div>
  </div>
  <div class="panel">
    <button id="restartBtn">↻</button>
  </div>
</div>

<button id="jumpBtn">ПРЫЖОК</button>

<div id="gameOver" class="game-over">Игра окончена</div>

<script>
/* =======================
   CANVAS
======================= */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() {
  const dpr = window.devicePixelRatio || 1;
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
  canvas.style.width = innerWidth + 'px';
  canvas.style.height = innerHeight + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
resize();
addEventListener('resize', resize);

/* =======================
   GAME CONFIG
======================= */
const GRAVITY = 0.7;
const JUMP_FORCE = 13;

let speed = 2.2;
let speedGrowth = 0.0025;

const centerY = innerHeight * 0.55;

/* =======================
   GAME STATE
======================= */
const cube = {
  x: 80,
  y: centerY - 60,
  size: 34,
  vy: 0,
  grounded: false
};

let platforms = [];
let score = 0;
let best = Number(localStorage.getItem('bestScore')) || 0;
let gameOver = false;

/* =======================
   UI
======================= */
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const gameOverEl = document.getElementById('gameOver');

bestEl.textContent = best;

/* =======================
   INIT
======================= */
function initPlatforms() {
  platforms = [{
    x: 0,
    y: centerY,
    width: 240,
    height: 20
  }];
}

/* =======================
   INPUT
======================= */
function jump() {
  if (cube.grounded && !gameOver) {
    cube.vy = -JUMP_FORCE;
    cube.grounded = false;
  }
}

jumpBtn.onclick = jump;
jumpBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  jump();
});

restartBtn.onclick = restart;

/* =======================
   GAME LOGIC
======================= */
function addPlatform() {
  const last = platforms[platforms.length - 1];
  const gap = rand(90, 160);
  let y = last.y + rand(-90, 90);
  y = clamp(y, centerY - 160, centerY + 100);

  platforms.push({
    x: last.x + last.width + gap,
    y,
    width: rand(100, 140),
    height: 20
  });
}

function update() {
  if (gameOver) return;

  cube.vy += GRAVITY;
  cube.y += cube.vy;
  cube.grounded = false;

  for (const p of platforms) {
    if (
      cube.vy >= 0 &&
      cube.x + cube.size > p.x &&
      cube.x < p.x + p.width &&
      cube.y + cube.size >= p.y &&
      cube.y + cube.size <= p.y + p.height
    ) {
      cube.y = p.y - cube.size;
      cube.vy = 0;
      cube.grounded = true;
    }
  }

  platforms.forEach(p => p.x -= speed);

  if (platforms.at(-1).x < canvas.width) addPlatform();

  if (platforms[0].x + platforms[0].width < 0) {
    platforms.shift();
    score++;
    scoreEl.textContent = score;
  }

  speed += speedGrowth;

  if (cube.y > canvas.height) finish();
}

/* =======================
   RENDER
======================= */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Cube
  ctx.fillStyle = '#fff';
  ctx.shadowColor = '#4ef3c2';
  ctx.shadowBlur = 20;
  ctx.fillRect(cube.x, cube.y, cube.size, cube.size);
  ctx.shadowBlur = 0;

  // Platforms
  ctx.fillStyle = '#4ef3c2';
  platforms.forEach(p =>
    ctx.fillRect(p.x, p.y, p.width, p.height)
  );
}

/* =======================
   LOOP
======================= */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/* =======================
   GAME FLOW
======================= */
function finish() {
  gameOver = true;
  gameOverEl.style.display = 'flex';

  if (score > best) {
    best = score;
    bestEl.textContent = best;
    localStorage.setItem('bestScore', best);
  }
}

function restart() {
  cube.y = centerY - 60;
  cube.vy = 0;
  cube.grounded = false;

  speed = 2.2;
  score = 0;
  scoreEl.textContent = 0;
  gameOver = false;
  gameOverEl.style.display = 'none';

  initPlatforms();
}

/* =======================
   HELPERS
======================= */
function rand(min, max) {
  return Math.random() * (max - min) + min;
}

function clamp(v, min, max) {
  return Math.max(min, Math.min(max, v));
}

/* =======================
   START
======================= */
initPlatforms();
loop();
</script>

</body>
</html>
