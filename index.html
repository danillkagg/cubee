<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>cubee</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #222;
    font-family: sans-serif;
    color: #fff;
    touch-action: manipulation;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: #333;
  }

  #ui-left {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
  }

  #ui-right {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
    text-align: right;
  }

  button {
    padding: 12px 24px;
    font-size: 18px;
  }

  #jumpBtn {
    position: absolute;
    bottom: 35px;
    left: 60%;
    transform: translateX(-60%);
    z-index: 20;
    font-size: 38px;
    padding: 35px 70px;
    border-radius: 22px;
  }
</style>
</head>

<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-left">
  <div>Очки: <span id="score">0</span></div>
  <button id="restartBtn">Перезапуск</button>
</div>

<div id="ui-right">
  <div>Рекорд: <span id="bestScore">0</span></div>
</div>

<button id="jumpBtn">ПРЫЖОК</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const centerY = window.innerHeight / 2;

// Куб
const cube = {
  x: 60,
  y: centerY - 60,
  size: 30,
  vy: 0,
  jumpForce: 13,
  grounded: false
};

const gravity = 0.6;

// Платформы
let platforms = [{
  x: 0,
  y: centerY,
  width: 220,
  height: 20
}];

const minY = centerY - 120;
const maxY = centerY + 80;
const gapMin = 70;
const gapMax = 140;

// Скорость
let speed = 2.2;
const speedIncrease = 0.003;

// Очки
let score = 0;
const scoreEl = document.getElementById('score');

// Рекорд
let bestScore = Number(localStorage.getItem('bestScore')) || 0;
const bestScoreEl = document.getElementById('bestScore');
bestScoreEl.textContent = bestScore;

let gameOver = false;

function jump() {
  if (gameOver) return;

  if (cube.grounded) {
    cube.vy = -cube.jumpForce;
    cube.grounded = false;
  }
}

document.getElementById('jumpBtn').addEventListener('click', jump);
document.getElementById('jumpBtn').addEventListener('touchstart', e => {
  e.preventDefault();
  jump();
});

document.getElementById('restartBtn').addEventListener('click', restartGame);

function generatePlatform() {
  const last = platforms[platforms.length - 1];
  const gap = Math.random() * (gapMax - gapMin) + gapMin;

  let y = last.y + (Math.random() - 0.5) * 80;
  y = Math.max(minY, Math.min(maxY, y));

  platforms.push({
    x: last.x + last.width + gap,
    y,
    width: 110,
    height: 20
  });
}

function update() {
  if (gameOver) return;

  cube.vy += gravity;
  cube.y += cube.vy;
  cube.grounded = false;

  for (const p of platforms) {
    if (
      cube.vy >= 0 &&
      cube.x + cube.size > p.x &&
      cube.x < p.x + p.width &&
      cube.y + cube.size >= p.y &&
      cube.y + cube.size <= p.y + p.height
    ) {
      cube.y = p.y - cube.size;
      cube.vy = 0;
      cube.grounded = true;
    }
  }

  platforms.forEach(p => p.x -= speed);

  if (platforms[platforms.length - 1].x < canvas.width) {
    generatePlatform();
  }

  if (platforms[0].x + platforms[0].width < 0) {
    platforms.shift();
    score++;
    scoreEl.textContent = score;
  }

  speed += speedIncrease;

  if (cube.y > canvas.height) {
    endGame();
  }
}

function endGame() {
  gameOver = true;

  if (score > bestScore) {
    bestScore = score;
    bestScoreEl.textContent = bestScore;
    localStorage.setItem('bestScore', bestScore);
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = 'red';
  ctx.fillRect(cube.x, cube.y, cube.size, cube.size);

  ctx.fillStyle = 'lime';
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));

  if (gameOver) {
    ctx.fillStyle = '#fff';
    ctx.font = '36px sans-serif';
    ctx.fillText('Игра окончена', canvas.width / 2 - 130, canvas.height / 2);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

function restartGame() {
  cube.y = centerY - 60;
  cube.vy = 0;
  cube.grounded = false;

  platforms = [{
    x: 0,
    y: centerY,
    width: 220,
    height: 20
  }];

  speed = 2;
  score = 0;
  scoreEl.textContent = score;
  gameOver = false;
}

loop();
</script>

</body>
</html>




