<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Jump Cube</title>

<style>
* { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }

body {
  margin: 0;
  overflow: hidden;
  background: linear-gradient(180deg,#0f2027,#203a43,#2c5364);
  font-family: system-ui, sans-serif;
  color: #fff;
}

canvas { display: block; }

.ui {
  position: absolute;
  top: env(safe-area-inset-top, 12px);
  left: env(safe-area-inset-left, 12px);
  right: env(safe-area-inset-right, 12px);
  display: flex;
  justify-content: space-between;
  pointer-events: none;
}

.panel {
  background: rgba(0,0,0,.35);
  padding: 12px 16px;
  border-radius: 14px;
  backdrop-filter: blur(6px);
  pointer-events: auto;
}

button {
  border: none;
  border-radius: 14px;
  padding: 12px 18px;
  font-size: 16px;
  font-weight: 600;
  background: linear-gradient(135deg,#4ef3c2,#3acfd5);
}

#jumpBtn {
  position: absolute;
  bottom: calc(env(safe-area-inset-bottom,0px) + 20px);
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
  padding: 20px 72px;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div class="ui">
  <div class="panel">
    Очки: <span id="score">0</span><br>
    Рекорд: <span id="best">0</span>
  </div>
</div>

<button id="jumpBtn">ПРЫЖОК</button>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() {
  const dpr = devicePixelRatio || 1;
  const h = window.visualViewport ? visualViewport.height : innerHeight;
  canvas.width = innerWidth * dpr;
  canvas.height = h * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
addEventListener('resize', resize);

/* ===== SCALE ===== */
const SCALE = Math.min(innerWidth / 390, 1.15);

/* ===== CENTER ===== */
const VIEW_H = window.visualViewport ? visualViewport.height : innerHeight;
const CENTER_Y = VIEW_H * 0.5;

/* ===== CONFIG ===== */
const CONFIG = {
  gravity: 0.7 * SCALE,
  jump: 12.5 * SCALE,
  speed: 2.4 * SCALE,
  speedGrowth: 0.002
};

/* ===== STATE ===== */
const cube = {
  x: 80 * SCALE,
  size: 34 * SCALE,
  y: 0,
  vy: 0,
  grounded: false
};

let platforms = [];
let speed = CONFIG.speed;
let score = 0;
let best = Number(localStorage.getItem('bestScore')) || 0;

document.getElementById('best').textContent = best;

/* ===== PLATFORMS ===== */
function initPlatforms() {
  const h = 20 * SCALE;
  const w = 260 * SCALE;

  platforms = [{
    x: 0,
    y: CENTER_Y - h / 2,
    width: w,
    height: h
  }];

  cube.y = platforms[0].y - cube.size;
}

function addPlatform() {
  const last = platforms.at(-1);
  platforms.push({
    x: last.x + last.width + 80 * SCALE,
    y: clamp(
      CENTER_Y + rand(-120, 120) * SCALE,
      60,
      canvas.height - 60
    ),
    width: rand(110,150) * SCALE,
    height: 20 * SCALE
  });
}

/* ===== INPUT ===== */
jumpBtn.onpointerdown = e => {
  e.preventDefault();
  if (cube.grounded) {
    cube.vy = -CONFIG.jump;
    cube.grounded = false;
  }
};

/* ===== UPDATE ===== */
function update() {
  cube.vy += CONFIG.gravity;
  cube.y += cube.vy;
  cube.grounded = false;

  for (const p of platforms) {
    if (
      cube.vy >= 0 &&
      cube.x + cube.size > p.x &&
      cube.x < p.x + p.width &&
      cube.y + cube.size >= p.y &&
      cube.y + cube.size <= p.y + p.height
    ) {
      cube.y = p.y - cube.size;
      cube.vy = 0;
      cube.grounded = true;
    }
  }

  platforms.forEach(p => p.x -= speed);

  if (platforms.at(-1).x < canvas.width) addPlatform();

  if (platforms[0].x + platforms[0].width < 0) {
    platforms.shift();
    score++;
    document.getElementById('score').textContent = score;
  }

  speed += CONFIG.speedGrowth;

  if (cube.y > canvas.height || cube.y < -cube.size) restart();
}

/* ===== DRAW ===== */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = '#fff';
  ctx.fillRect(cube.x, cube.y, cube.size, cube.size);

  ctx.fillStyle = '#4ef3c2';
  platforms.forEach(p => ctx.fillRect(p.x,p.y,p.width,p.height));
}

/* ===== LOOP ===== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/* ===== HELPERS ===== */
function rand(min,max){return Math.random()*(max-min)+min;}
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

/* ===== START ===== */
function restart() {
  speed = CONFIG.speed;
  score = 0;
  document.getElementById('score').textContent = 0;
  initPlatforms();
}

restart();
loop();
</script>

</body>
</html>
