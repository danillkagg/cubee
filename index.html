<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width,
               initial-scale=1,
               maximum-scale=1,
               user-scalable=no">

<title>Jump Cube</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  background: linear-gradient(180deg, #0f2027, #203a43, #2c5364);
  overflow: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  touch-action: manipulation;
  color: #fff;
}

/* Центровка canvas */
#gameWrapper {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

canvas {
  display: block;
  background: transparent;
}

/* UI */
.ui {
  position: fixed;
  top: env(safe-area-inset-top, 12px);
  left: 12px;
  right: 12px;
  display: flex;
  justify-content: space-between;
  pointer-events: none;
}

.panel {
  pointer-events: auto;
  background: rgba(0,0,0,.35);
  padding: 10px 14px;
  border-radius: 14px;
  backdrop-filter: blur(6px);
}

button, select {
  border: none;
  border-radius: 14px;
  padding: 10px 16px;
  font-size: 16px;
  font-weight: 600;
}

button {
  background: linear-gradient(135deg, #4ef3c2, #3acfd5);
  color: #000;
}

#jumpBtn {
  position: fixed;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 24px);
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
  padding: 20px 64px;
}

/* Pause menu */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.65);
  display: none;
  align-items: center;
  justify-content: center;
}

.menu {
  background: rgba(0,0,0,.55);
  padding: 26px;
  border-radius: 18px;
  text-align: center;
  min-width: 260px;
}
</style>
</head>

<body>

<div id="gameWrapper">
  <canvas id="canvas"></canvas>
</div>

<div class="ui">
  <div class="panel">
    Очки: <span id="score">0</span><br>
    Рекорд: <span id="best">0</span>
  </div>
  <div class="panel">
    <button id="pauseBtn">⏸</button>
  </div>
</div>

<button id="jumpBtn">ПРЫЖОК</button>

<div id="pauseMenu" class="overlay">
  <div class="menu">
    <h2>Пауза</h2>

    <div>
      Сложность:<br>
      <select id="difficulty">
        <option value="easy">Лёгкая</option>
        <option value="normal" selected>Нормальная</option>
        <option value="hard">Хард</option>
      </select>
    </div><br>

    <div>
      Режим:<br>
      <select id="mode">
        <option value="classic">Классика</option>
        <option value="gravityChaos">Хаос гравитации</option>
        <option value="speedRush">Speed Rush</option>
      </select>
    </div><br>

    <button onclick="togglePause()">Продолжить</button>
  </div>
</div>

<script>
/* ================= GAME RESOLUTION ================= */
const GAME_WIDTH  = 390;
const GAME_HEIGHT = 844;

/* ================= CANVAS ================= */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let scale = 1;

function resize() {
  const dpr = window.devicePixelRatio || 1;

  const sw = window.innerWidth;
  const sh = window.innerHeight;

  scale = Math.min(sw / GAME_WIDTH, sh / GAME_HEIGHT);

  canvas.style.width  = GAME_WIDTH  * scale + 'px';
  canvas.style.height = GAME_HEIGHT * scale + 'px';

  canvas.width  = GAME_WIDTH  * dpr;
  canvas.height = GAME_HEIGHT * dpr;

  ctx.setTransform(dpr * scale, 0, 0, dpr * scale, 0, 0);
}
resize();
window.addEventListener('resize', resize);

/* ================= CONFIG ================= */
const DIFFICULTIES = {
  easy:   { gravity: 0.55, jump: 13.2, baseSpeed: 2.0, speedGrowth: 0.0015 },
  normal: { gravity: 0.65, jump: 12.6, baseSpeed: 2.4, speedGrowth: 0.0022 },
  hard:   { gravity: 0.75, jump: 12.0, baseSpeed: 2.9, speedGrowth: 0.0030 }
};

let config;
let mode = 'classic';

/* ================= STATE ================= */
const groundY = GAME_HEIGHT * 0.55;

const cube = {
  x: 80,
  y: groundY - 60,
  size: 34,
  vy: 0,
  grounded: false
};

let platforms = [];
let speed = 0;
let score = 0;
let paused = false;

const scoreEl = document.getElementById('score');
const bestEl  = document.getElementById('best');
const pauseMenu = document.getElementById('pauseMenu');

let best = Number(localStorage.getItem('bestScore')) || 0;
bestEl.textContent = best;

/* ================= PLATFORMS ================= */
function initPlatforms() {
  platforms = [{
    x: 0,
    y: groundY,
    width: 260,
    height: 20
  }];
}

function addPlatform() {
  const last = platforms.at(-1);
  platforms.push({
    x: last.x + last.width + 80 + speed * 8,
    y: clamp(last.y + rand(-60, 60), groundY - 150, groundY + 120),
    width: rand(110, 150),
    height: 20
  });
}

/* ================= INPUT ================= */
function jump() {
  if (!paused && cube.grounded) {
    cube.vy = -config.jump;
    cube.grounded = false;
  }
}

jumpBtn.addEventListener('click', jump);
jumpBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  jump();
}, { passive: false });

pauseBtn.onclick = togglePause;

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') togglePause();
});

/* ================= PAUSE ================= */
function togglePause() {
  paused = !paused;
  pauseMenu.style.display = paused ? 'flex' : 'none';

  if (!paused) {
    config = DIFFICULTIES[difficulty.value];
    mode = document.getElementById('mode').value;
  }
}

/* ================= UPDATE ================= */
function update() {
  if (paused) return;

  let gravity = config.gravity;
  if (mode === 'gravityChaos') gravity += rand(-0.2, 0.2);

  cube.vy += gravity;
  cube.y += cube.vy;
  cube.grounded = false;

  for (const p of platforms) {
    if (
      cube.vy >= 0 &&
      cube.x + cube.size > p.x &&
      cube.x < p.x + p.width &&
      cube.y + cube.size >= p.y &&
      cube.y + cube.size <= p.y + p.height
    ) {
      cube.y = p.y - cube.size;
      cube.vy = 0;
      cube.grounded = true;
    }
  }

  const speedMul = mode === 'speedRush' ? 2 : 1;
  platforms.forEach(p => p.x -= speed * speedMul);

  if (platforms.at(-1).x < GAME_WIDTH) addPlatform();

  if (platforms[0].x + platforms[0].width < 0) {
    platforms.shift();
    score++;
    scoreEl.textContent = score;
  }

  speed += config.speedGrowth * speedMul;

  if (cube.y > GAME_HEIGHT) restart();
}

/* ================= DRAW ================= */
function draw() {
  ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

  ctx.fillStyle = '#fff';
  ctx.shadowColor = '#4ef3c2';
  ctx.shadowBlur = 14;
  ctx.fillRect(cube.x, cube.y, cube.size, cube.size);
  ctx.shadowBlur = 0;

  ctx.fillStyle = '#4ef3c2';
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));
}

/* ================= LOOP ================= */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/* ================= HELPERS ================= */
function rand(min, max) { return Math.random() * (max - min) + min; }
function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

/* ================= START ================= */
function restart() {
  config = DIFFICULTIES[difficulty.value];
  cube.y = groundY - 60;
  cube.vy = 0;
  speed = config.baseSpeed;
  score = 0;
  scoreEl.textContent = 0;
  initPlatforms();
}

restart();
loop();
</script>

</body>
</html>
